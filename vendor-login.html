<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Vendor Login - Stayscape</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
            rel="stylesheet"
        />
        <link
            href="https://unpkg.com/aos@2.3.1/dist/aos.css"
            rel="stylesheet"
        />
        <link href="styles.css" rel="stylesheet" />
        <style>
            .vendor-login-bg {
                background: linear-gradient(
                    135deg,
                    var(--success-color),
                    var(--warning-color)
                );
                min-height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .login-card {
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(10px);
                border-radius: 20px;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
            }
            .vendor-icon {
                width: 80px;
                height: 80px;
                background: linear-gradient(
                    135deg,
                    var(--success-color),
                    var(--warning-color)
                );
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 0 auto 2rem;
                color: white;
                font-size: 2rem;
            }
            .form-floating .form-control {
                border-radius: 15px;
                border: 2px solid #e9ecef;
                transition: all 0.3s ease;
            }
            .form-floating .form-control:focus {
                border-color: var(--success-color);
                box-shadow: 0 0 0 0.2rem rgba(214, 0, 111, 0.25);
            }
            .btn-vendor {
                background: linear-gradient(
                    135deg,
                    var(--success-color),
                    var(--warning-color)
                );
                border: none;
                border-radius: 15px;
                padding: 15px;
                font-weight: 600;
                transition: all 0.3s ease;
            }
            .btn-vendor:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 20px rgba(214, 0, 111, 0.3);
            }
        </style>
    </head>
    <body>
        <!-- Scroll Progress Bar -->
        <div class="scroll-progress" id="scrollProgress"></div>

        <!-- Header -->
        <div class="scroll-progress" id="scrollProgress"></div>
        <!-- Go to Top Button -->
        <a href="#" class="floating-btn" id="backToTop">
            <i class="fas fa-arrow-up"></i>
        </a>
        <div class="vendor-login-bg">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-md-6 col-lg-4">
                        <div
                            class="login-card p-5"
                            data-aos="flip-left"
                            data-aos-duration="1000"
                        >
                            <div class="text-center mb-4">
                                <div
                                    class="vendor-icon"
                                    data-aos="zoom-in"
                                    data-aos-delay="200"
                                >
                                    <i class="fas fa-store"></i>
                                </div>
                                <h2
                                    class="fw-bold dd"
                                    data-aos="fade-down"
                                    data-aos-delay="300"
                                >
                                    Vendor Portal
                                </h2>
                                <p
                                    class="text-muted cd"
                                    data-aos="fade-up"
                                    data-aos-delay="400"
                                >
                                    Manage your properties
                                </p>
                            </div>

                            <form
                                id="vendorLoginForm"
                                data-aos="fade-up"
                                data-aos-delay="500"
                            >
                                <div class="form-floating mb-3">
                                    <input
                                        type="email"
                                        class="form-control"
                                        id="vendorEmail"
                                        placeholder="vendor@stayscape.com"
                                        required
                                    />
                                    <label for="vendorEmail"
                                        >Vendor Email</label
                                    >
                                    <div class="invalid-feedback">
                                        Please enter a valid vendor email.
                                    </div>
                                </div>

                                <div class="form-floating mb-4">
                                    <input
                                        type="password"
                                        class="form-control"
                                        id="vendorPassword"
                                        placeholder="Password"
                                        required
                                    />
                                    <label for="vendorPassword">Password</label>
                                    <div class="invalid-feedback">
                                        Please enter your password.
                                    </div>
                                </div>

                                <div class="form-check mb-4">
                                    <input
                                        class="form-check-input"
                                        type="checkbox"
                                        id="rememberVendor"
                                    />
                                    <label
                                        class="form-check-label"
                                        for="rememberVendor"
                                    >
                                        Remember me
                                    </label>
                                </div>

                                <button
                                    type="submit"
                                    class="btn btn-vendor text-white w-100 mb-3"
                                    id="vendorLoginBtn"
                                >
                                    <i class="fas fa-sign-in-alt me-2"></i
                                    >Access Vendor Panel
                                </button>
                            </form>

                            <div
                                class="text-center"
                                data-aos="fade-up"
                                data-aos-delay="600"
                            >
                                <p class="mb-2">
                                    <small class="text-muted"
                                        >Demo Credentials:</small
                                    >
                                </p>
                                <p class="mb-1">
                                    <small
                                        ><strong>Email:</strong>
                                        vendor@stayscape.com</small
                                    >
                                </p>
                                <p class="mb-3">
                                    <small
                                        ><strong>Password:</strong>
                                        vendor123</small
                                    >
                                </p>
                                <a
                                    href="admin-login.html"
                                    class="text-decoration-none"
                                    >Admin Login</a
                                >
                                |
                                <a
                                    href="index.html"
                                    class="text-decoration-none"
                                    >Back to Home</a
                                >
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Modal -->
        <div
            class="modal fade"
            id="loadingModal"
            tabindex="-1"
            data-bs-backdrop="static"
            data-bs-keyboard="false"
        >
            <div class="modal-dialog modal-sm modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-body text-center">
                        <div class="spinner-border text-success" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-2 mb-0">Authenticating...</p>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
        <script>
            AOS.init({
                duration: 1000,
                once: true,
                offset: 100,
            });

            function showLoading() {
                const modal = new bootstrap.Modal(
                    document.getElementById('loadingModal')
                );
                modal.show();
            }

            function hideLoading() {
                const loadingModal = document.getElementById('loadingModal');
                const modal = bootstrap.Modal.getInstance(loadingModal);

                if (modal) {
                    modal.hide();
                }

                // Force cleanup
                setTimeout(() => {
                    // Remove modal backdrop
                    const backdrops =
                        document.querySelectorAll('.modal-backdrop');
                    backdrops.forEach(backdrop => backdrop.remove());

                    // Reset body styles
                    document.body.classList.remove('modal-open');
                    document.body.style.overflow = '';
                    document.body.style.paddingRight = '';
                    document.body.removeAttribute('style');

                    // Hide modal directly
                    loadingModal.style.display = 'none';
                    loadingModal.classList.remove('show');
                    loadingModal.setAttribute('aria-hidden', 'true');
                    loadingModal.removeAttribute('aria-modal');
                    loadingModal.removeAttribute('role');
                }, 100);
            }

            function showAlert(message, type = 'danger') {
                // Remove any existing alerts
                const existingAlerts = document.querySelectorAll('.alert');
                existingAlerts.forEach(alert => alert.remove());

                const alertDiv = document.createElement('div');
                alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
                alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

                const form = document.getElementById('vendorLoginForm');
                form.parentNode.insertBefore(alertDiv, form);

                setTimeout(() => {
                    if (alertDiv && alertDiv.parentNode) {
                        alertDiv.remove();
                    }
                }, 5000);
            }

            document
                .getElementById('vendorLoginForm')
                .addEventListener('submit', async function (e) {
                    e.preventDefault();

                    const email = document
                        .getElementById('vendorEmail')
                        .value.trim();
                    const password =
                        document.getElementById('vendorPassword').value;
                    const loginBtn = document.getElementById('vendorLoginBtn');

                    // Clear previous validation states
                    document
                        .querySelectorAll('.is-invalid')
                        .forEach(el => el.classList.remove('is-invalid'));

                    // Validate inputs
                    let isValid = true;

                    if (!email) {
                        document
                            .getElementById('vendorEmail')
                            .classList.add('is-invalid');
                        isValid = false;
                    }

                    if (!password) {
                        document
                            .getElementById('vendorPassword')
                            .classList.add('is-invalid');
                        isValid = false;
                    }

                    if (!isValid) {
                        showAlert('Please fill in all required fields.');
                        return;
                    }

                    try {
                        showLoading();
                        loginBtn.disabled = true;

                        const response = await fetch('vendor-auth.php', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                action: 'vendor_login',
                                email: email,
                                password: password,
                            }),
                        });

                        if (!response.ok) {
                            throw new Error(
                                `HTTP error! status: ${response.status}`
                            );
                        }

                        const result = await response.json();

                        hideLoading();
                        loginBtn.disabled = false;

                        if (result.success) {
                            localStorage.setItem(
                                'vendorUser',
                                JSON.stringify(result.data.vendor)
                            );
                            showAlert(
                                'Login successful! Redirecting...',
                                'success'
                            );

                            setTimeout(() => {
                                window.location.href = 'vendor-panel.html';
                            }, 1500);
                        } else {
                            showAlert(
                                result.message ||
                                    'Login failed. Please check your credentials.'
                            );
                        }
                    } catch (error) {
                        hideLoading();
                        loginBtn.disabled = false;
                        console.error('Login error:', error);
                        showAlert(
                            'Connection error. Please check your internet connection and try again.'
                        );
                    }
                });

            // Auto-focus on email field
            document.addEventListener('DOMContentLoaded', function () {
                document.getElementById('vendorEmail').focus();
            });
        </script>
    </body>
</html>
